!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="./",n(n.s=9)}([function(e,t,n){(e.exports=function(){this.events={}}).prototype={emit:function(e){if((e=this.events[e])&&e[0]){var t=e.slice.call(arguments,1);e.slice().map(function(e){e.apply(this,t)})}},on:function(e,t){return(e=this.events[e]=this.events[e]||[]).push(t),function(){e.splice(e.indexOf(t)>>>0,1)}}}},function(e,t){e.exports=function(e,t){for(var n in e||(e={}),t)void 0===e[n]&&(e[n]=t[n]);return e}},function(e,t,n){var o=n(3);function i(e,t){return e.lastAdded+=1,t[1].added=e.lastAdded,e.added.push(t),Promise.resolve(t[1])}function r(e,t){for(var n=e.length-1;n>=0;n--)if(t===e[n][1].id)return n;return-1}function s(e){return void 0!==e}function c(){this.created=[],this.added=[],this.lastReceived=0,this.lastAdded=0,this.lastSent=0}c.prototype={add:function(e,t){for(var n=[e,t],r=t.id,s=this.created,c=0;c<s.length;c++){var d=s[c];if(r===d[1].id)return Promise.resolve(!1);if(!o(d[1],t))return s.splice(c,0,n),i(this,n)}return s.push(n),i(this,n)},byId:function(e){var t=r(this.created,e);if(-1===t)return Promise.resolve([null,null]);var n=this.created[t];return Promise.resolve([n[0],n[1]])},remove:function(e,t){if(void 0===t&&-1===(t=r(this.created,e)))return Promise.resolve(!1);var n=[this.created[t][0],this.created[t][1]];this.created.splice(t,1);for(var o=n[1].added,i=0,s=this.added.length-1;i<=s;){var c=s+i>>1,d=this.added[c][1].added;if(d<o)i=c+1;else{if(!(d>o)){this.added.splice(c,1);break}s=c-1}}return Promise.resolve(n)},get:function(e){var t;return t="created"===e.order?this.created:this.added,Promise.resolve({entries:t.slice(0)})},changeMeta:function(e,t){var n=r(this.created,e);if(-1===n)return Promise.resolve(!1);var o=this.created[n][1];for(var i in t)o[i]=t[i];return Promise.resolve(!0)},removeReason:function(e,t,n){var i,c,d=[];if(t.id){var a=r(this.created,t.id);-1!==a&&(i=this.created[a][1],-1!==(c=i.reasons.indexOf(e))&&(i.reasons.splice(c,1),0===i.reasons.length&&(n(this.created[a][0],i),this.remove(t.id))))}else this.created=this.created.filter(function(r){i=r[1];var a=t;return-1===(c=i.reasons.indexOf(e))||(!(!s(a.olderThan)||o(i,a.olderThan))||(!(!s(a.youngerThan)||o(a.youngerThan,i))||(!!(s(a.minAdded)&&i.added<a.minAdded)||(!!(s(a.maxAdded)&&i.added>a.maxAdded)||(i.reasons.splice(c,1),0!==i.reasons.length||(n(r[0],i),d.push(i.added),!1))))))}),this.added=this.added.filter(function(e){return-1===d.indexOf(e[1].added)});return Promise.resolve()},clean:function(){return this.created=[],this.added=[],this.lastReceived=0,this.lastAdded=0,this.lastSent=0,Promise.resolve()},getLastAdded:function(){return Promise.resolve(this.lastAdded)},getLastSynced:function(){return Promise.resolve({received:this.lastReceived,sent:this.lastSent})},setLastSynced:function(e){return void 0!==e.sent&&(this.lastSent=e.sent),void 0!==e.received&&(this.lastReceived=e.received),Promise.resolve()}},e.exports=c},function(e,t){function n(e){var t=e.indexOf(" ");return[e.slice(0,t),e.slice(t+1)]}e.exports=function(e,t){if(e&&!t)return!1;if(!e&&t)return!0;if(e.time>t.time)return!1;if(e.time<t.time)return!0;var o=n(e.id),i=n(t.id);return!(o[1]>i[1])&&(o[1]<i[1]||!(o[0]>i[0])&&o[0]<i[0])}},function(e,t,n){var o=n(5),i=n(1),r={fixTime:!0,timeout:2e4,ping:5e3};function s(e,t,n,s){s=i(s,r),o.call(this,e,t,n,s)}s.prototype={onConnect:function(){if(!this.connected){this.connected=!0;var e=this;this.initializing=this.initializing.then(function(){e.connected&&e.sendConnect()})}}},s.prototype=i(s.prototype,o.prototype),e.exports=s},function(e,t,n){var o=n(0),i=n(10),r=n(11),s=n(12),c=n(13),d=n(14),a=n(6),A=[r,i,s,c,d],u={"wrong-subprotocol":!0,"wrong-protocol":!0,timeout:!0},h=["connect","connected","error","debug"];function g(e,t,n){var o=n.added;void 0===o&&(o=e.lastSent),e.options.outMap?e.options.outMap(t,n).then(function(t){e.sendSync(o,[t])}).catch(function(t){e.error(t)}):e.sendSync(o,[[t,n]])}function l(e,t,n,i){if(this.localNodeId=e,this.log=t,this.connection=n,this.options=i||{},this.options.ping&&!this.options.timeout)throw new Error("You must set timeout option to use ping");this.connected=!1,this.authenticated=!1,this.unauthenticated=[],this.timeFix=0,this.syncing=0,this.received={},this.lastSent=0,this.lastReceived=0,this.state="disconnected",this.emitter=new o,this.timeouts=[],this.throwsError=!0,this.unbind=[];var r=this;this.unbind.push(t.on("add",function(e,t){r.onAdd(e,t)})),this.unbind.push(n.on("connecting",function(){r.onConnecting()})),this.unbind.push(n.on("connect",function(){r.onConnect()})),this.unbind.push(n.on("message",function(e){r.onMessage(e)})),this.unbind.push(n.on("error",function(e){"Wrong message format"===e.message?(r.sendError(new a("wrong-format",e.received)),r.connection.disconnect("error")):r.error(e)})),this.unbind.push(n.on("disconnect",function(){r.onDisconnect()})),this.initialized=!1,this.lastAddedCache=0,this.initializing=this.initialize()}l.prototype={remoteNodeId:void 0,localProtocol:2,minProtocol:2,remoteProtocol:void 0,remoteSubprotocol:void 0,on:function(e,t){return this.emitter.on(e,t)},catch:function(e){this.throwsError=!1,this.on("error",e)},waitFor:function(e){if(this.state===e)return Promise.resolve();var t=this;return new Promise(function(n){var o=t.on("state",function(){t.state===e&&(o(),n())})})},destroy:function(){this.connection.destroy?this.connection.destroy():this.connected&&this.connection.disconnect("destroy");for(var e=0;e<this.unbind.length;e++)this.unbind[e]();clearTimeout(this.pingTimeout),this.endTimeout()},send:function(e){if(this.connected){this.delayPing();try{this.connection.send(e)}catch(e){this.error(e)}}},onConnecting:function(){this.setState("connecting")},onConnect:function(){this.delayPing(),this.connected=!0},onDisconnect:function(){for(;this.timeouts.length>0;)this.endTimeout();this.pingTimeout&&clearTimeout(this.pingTimeout),this.authenticated=!1,this.connected=!1,this.setState("disconnected")},onMessage:function(e){this.delayPing();var t=e[0];if(this.authenticated||-1!==h.indexOf(t)){for(var n=new Array(e.length-1),o=1;o<e.length;o++)n[o-1]=e[o];this[t+"Message"].apply(this,n)}else this.unauthenticated.push(e)},onAdd:function(e,t){if(this.authenticated)if(this.lastAddedCache<t.added&&(this.lastAddedCache=t.added),this.received[t.id])delete this.received[t.id];else if(this.options.outFilter){var n=this;this.options.outFilter(e,t).then(function(o){o&&g(n,e,t)}).catch(function(e){n.error(e)})}else g(this,e,t)},syncError:function(e,t,n){var o=new a(e,t,n);if(this.emitter.emit("error",o),!u[e]&&this.throwsError)throw o},error:function(e){if(this.emitter.emit("error",e),this.connection.disconnect("error"),this.throwsError)throw e},setState:function(e){this.state!==e&&(this.state=e,this.emitter.emit("state"))},startTimeout:function(){if(this.options.timeout){var e=this.options.timeout,t=this,n=setTimeout(function(){t.connected&&t.connection.disconnect("timeout"),t.syncError("timeout",e)},e);this.timeouts.push(n)}},endTimeout:function(){this.timeouts.length>0&&clearTimeout(this.timeouts.shift())},delayPing:function(){if(this.options.ping){this.pingTimeout&&clearTimeout(this.pingTimeout);var e=this;this.pingTimeout=setTimeout(function(){e.connected&&e.authenticated&&e.sendPing()},this.options.ping)}},syncSinceQuery:function(e){var t=this,n=[];return this.log.each({order:"added"},function(o,i){return!(i.added<=e)&&(t.options.outFilter?n.push(t.options.outFilter(o,i).then(function(e){return!!e&&[o,i]}).catch(function(e){t.error(e)})):n.push(Promise.resolve([o,i])),!0)}).then(function(){return Promise.all(n)}).then(function(e){var t={added:0};return t.entries=e.filter(function(e){return e&&t.added<e[1].added&&(t.added=e[1].added),!1!==e}),t})},syncSince:function(e){var t=this;this.syncSinceQuery(e).then(function(e){t.connected&&(e.entries.length>0?t.options.outMap?Promise.all(e.entries.map(function(e){return t.options.outMap(e[0],e[1])})).then(function(n){t.sendSync(e.added,n)}).catch(function(e){t.error(e)}):t.sendSync(e.added,e.entries):t.setState("synchronized"))})},setLastSent:function(e){this.lastSent<e&&(this.lastSent=e),this.log.store.setLastSynced({sent:e})},setLastReceived:function(e){this.lastReceived<e&&(this.lastReceived=e),this.log.store.setLastSynced({received:e})},now:function(){return Date.now()},initialize:function(){var e=this;return Promise.all([this.log.store.getLastSynced(),this.log.store.getLastAdded()]).then(function(t){e.initialized=!0,e.lastSent=t[0].sent,e.lastReceived=t[0].received,e.lastAddedCache=t[1],e.connection.connected&&e.onConnect()})},sendDuilian:function(){this.send(["duilian",Object.keys(v)[0]])},duilianMessage:function(e){v[e]&&this.send(["duilian",v[e]])}};for(var f=0;f<=A.length;f++){var m=A[f];for(var p in m)l.prototype[p]=m[p]}var v={"金木水火土":"板城烧锅酒"};e.exports=l},function(e,t){function n(e,t,o){Error.call(this,e),this.name="SyncError",this.type=e,this.options=t,this.description=n.describe(e,t),this.received=!!o,this.message="",o?(this.message+="Logux received "+this.type+" error",this.description!==this.type&&(this.message+=" ("+this.description+")")):this.message=this.description,Error.captureStackTrace&&Error.captureStackTrace(this,n)}n.describe=function(e,t){return"timeout"===e?"A timeout was reached ("+t+"ms)":"wrong-format"===e?"Wrong message format in "+t:"unknown-message"===e?"Unknown message `"+t+"` type":"bruteforce"===e?"Too many wrong authentication attempts":"wrong-protocol"===e?"Logux supports protocols only from version "+t.supported+", but you use "+t.used:"wrong-subprotocol"===e?"Only "+t.supported+" application subprotocols are supported, but you use "+t.used:"wrong-credentials"===e?"Wrong credentials":e},n.prototype=Error.prototype,e.exports=n},function(e,t,n){var o=n(0);function i(e){if(e||(e={}),void 0===e.nodeId)throw new Error("Expected node ID");if("object"!=typeof e.store)throw new Error("Expected store");if(-1!==e.nodeId.indexOf(" "))throw new Error("Space is prohibited in node ID");this.nodeId=e.nodeId,this.lastTime=0,this.sequence=0,this.store=e.store,this.emitter=new o}i.prototype={on:function(e,t){return this.emitter.on(e,t)},add:function(e,t){if(void 0===e.type)throw new Error('Expected "type" in action');t||(t={});var n=!1;void 0===t.id&&(n=!0,t.id=this.generateId()),void 0===t.time&&(t.time=parseInt(t.id)),void 0===t.reasons?t.reasons=[]:Array.isArray(t.reasons)||(t.reasons=[t.reasons]),t.reasons.forEach(function(e){if("string"!=typeof e)throw new Error('Expected "reasons" to be strings')});var o=this;return this.emitter.emit("preadd",e,t),t.keepLast&&(this.removeReason(t.keepLast,{olderThan:t}),t.reasons.push(t.keepLast)),0===t.reasons.length&&n?(this.emitter.emit("add",e,t),this.emitter.emit("clean",e,t),Promise.resolve(t)):0===t.reasons.length?this.store.byId(t.id).then(function(n){return!n[0]&&(o.emitter.emit("add",e,t),o.emitter.emit("clean",e,t),t)}):this.store.add(e,t).then(function(t){return!1!==t&&(o.emitter.emit("add",e,t),t)})},generateId:function(){var e=Date.now();return e<=this.lastTime?(e=this.lastTime,this.sequence+=1):(this.lastTime=e,this.sequence=0),e+" "+this.nodeId+" "+this.sequence},each:function(e,t){t||(t=e,e={order:"created"});var n=this.store;return new Promise(function(o){!function e(n){n().then(function(n){for(var i,r=n.entries.length-1;r>=0;r--){var s=n.entries[r];if(!1===(i=t(s[0],s[1])))break}!1!==i&&n.next?e(n.next):o()})}(n.get.bind(n,e))})},changeMeta:function(e,t){var n;for(n in t)if("id"===n||"added"===n||"time"===n)throw new Error('Meta "'+n+'" is read-only');var o=this.emitter;return t.reasons&&0===t.reasons.length?this.store.remove(e).then(function(e){if(e){for(n in t)e[1][n]=t[n];o.emit("clean",e[0],e[1])}return!!e}):this.store.changeMeta(e,t)},removeReason:function(e,t){t||(t={});var n=this;return this.store.removeReason(e,t,function(e,t){n.emitter.emit("clean",e,t)})},byId:function(e){return this.store.byId(e)}},e.exports=i},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var o=n(2),i=n(4),r=n(15),s=n(5),c=n(7),d=n(16),a=n(22),A=n(23),u=n(24),h=n(25),g=n(27),l=n(29),f=n(30),m=n(35),p=n(36),v=n(37),y=new r(500);new s("server:uuid",new c({store:new o,nodeId:"server:uuid"}),y.right);var I=new d({subprotocol:"1.0.0",userId:10,server:"wss://example.com/"}),D=new i(I.node.localNodeId,I.log,y.left);D.connection.url="wss://example.com/",D.emitter=I.node.emitter,I.node=D,a(I),A(I),u(I,{normal:p,offline:m,error:v}),h(I,{messages:l,styles:f}),g(I);var b=0;function w(){document.title=function(e){return"disconnected"===e?"😴":"connecting"===e?"🔌":"😊"}(I.state)+" "+function(e){return e.slice(0,1).toUpperCase()}(I.role)+" "+b}I.on("state",function(){document.all.connection.checked=I.connected,w()}),I.on("role",function(){w(),document.all.connection.disabled="leader"!==I.role}),I.on("add",function(e){"TICK"===e.type&&b++,w()}),I.on("clean",function(e){"TICK"===e.type&&b--,w()}),I.log.each(function(e){"TICK"===e.type&&b++}).then(function(){w()}),I.on("role",function(){var e="leader"===I.role;document.all.connection.disabled=!e,document.all.disabled.style.display=e?"none":"inline"}),I.start(),document.all.connection.onchange=function(e){e.target.checked?I.node.connection.connect():I.node.connection.disconnect()},document.all.add.onclick=function(){I.log.add({type:"TICK"},{reasons:["tick"]})},document.all.clean.onclick=function(){I.log.removeReason("tick")},document.all.error.onclick=function(){setTimeout(function(){I.log.add({type:"logux/undo",reason:"error"})},3e3)},document.all.denied.onclick=function(){setTimeout(function(){I.log.add({type:"logux/undo",reason:"denied"})},3e3)},document.all.serverError.onclick=function(){setTimeout(function(){y.right.send(["error","wrong-format"])},3e3)},document.all.subprotocolError.onclick=function(){I.node.syncError("wrong-subprotocol",{supported:"2.x",used:"1.0.0"})}},function(e,t,n){var o=n(6);function i(e,t,n,i){if(!e.options.auth)return e.authenticated=!0,void i();e.options.auth(n,t).then(function(t){if(t){e.authenticated=!0,i();for(var n=0;n<e.unauthenticated.length;n++)e.onMessage(e.unauthenticated[n]);e.unauthenticated=[]}else e.sendError(new o("wrong-credentials")),e.destroy()}).catch(function(t){"SyncError"===t.name?(e.sendError(t),e.destroy()):e.error(t)})}function r(e,t){return e.remoteProtocol=t,t>=e.minProtocol||(e.sendError(new o("wrong-protocol",{supported:e.minProtocol,used:t})),e.destroy(),!1)}function s(e){try{e.emitter.emit("connect")}catch(t){if("SyncError"===t.name)return e.sendError(t),!1;throw t}return!0}e.exports={sendConnect:function(){var e=["connect",this.localProtocol,this.localNodeId,this.lastReceived],t={};this.options.credentials&&(t.credentials=this.options.credentials),this.options.subprotocol&&(t.subprotocol=this.options.subprotocol),Object.keys(t).length>0&&e.push(t),this.options.fixTime&&(this.connectSended=this.now()),this.startTimeout(),this.send(e)},sendConnected:function(e,t){var n=["connected",this.localProtocol,this.localNodeId,[e,t]],o={};this.options.credentials&&(o.credentials=this.options.credentials),this.options.subprotocol&&(o.subprotocol=this.options.subprotocol),Object.keys(o).length>0&&n.push(o),this.send(n)},connectMessage:function(e,t,n,o){var c=this.now();if(o||(o={}),this.remoteNodeId=t,r(this,e))if(this.remoteSubprotocol=o.subprotocol||"0.0.0",s(this)){var d=this;i(this,t,o.credentials,function(){d.baseTime=d.now(),d.sendConnected(c,d.baseTime),d.syncSince(n)})}else this.destroy()},connectedMessage:function(e,t,n,o){if(o||(o={}),this.endTimeout(),this.remoteNodeId=t,r(this,e)){if(this.baseTime=n[1],this.options.fixTime){var c=this.now(),d=n[1]-n[0],a=c-this.connectSended-d;this.timeFix=Math.floor(this.connectSended-n[0]+a/2)}if(this.remoteSubprotocol=o.subprotocol||"0.0.0",s(this)){var A=this;i(this,t,o.credentials,function(){A.syncSince(A.lastSent)})}else this.destroy()}}}},function(e,t){e.exports={sendError:function(e){var t=["error",e.type];void 0!==e.options&&t.push(e.options),this.send(t),this.emitter.emit("clientError",e)},errorMessage:function(e,t){this.syncError(e,t,!0)}}},function(e,t){e.exports={sendPing:function(){this.startTimeout(),this.send(["ping",this.lastAddedCache]),this.pingTimeout&&clearTimeout(this.pingTimeout)},pingMessage:function(e){this.setLastReceived(e),this.connected&&this.authenticated&&this.send(["pong",this.lastAddedCache])},pongMessage:function(e){this.setLastReceived(e),this.endTimeout()}}},function(e,t){e.exports={sendSync:function(e,t){this.startTimeout();for(var n=[],o=0;o<t.length;o++){var i=t[o][1],r={};for(var s in i)"id"===s?r.id=i.id.split(" "):"added"!==s&&(r[s]=i[s]);this.timeFix&&(r.time-=this.timeFix),r.id[0]=parseInt(r.id[0])-this.baseTime,r.id[2]=parseInt(r.id[2]),r.time-=this.baseTime,r.id[1]===this.localNodeId&&(0===r.id[2]?r.id=r.id[0]:r.id=[r.id[0],r.id[2]]),n.unshift(t[o][0],r)}this.syncing+=1,this.setState("sending"),this.send(["sync",e].concat(n))},sendSynced:function(e){this.send(["synced",e])},syncMessage:function(e){for(var t=this,n=[],o=1;o<arguments.length-1;o+=2){var i=arguments[o],r=arguments[o+1];"number"==typeof r.id?r.id=r.id+this.baseTime+" "+this.remoteNodeId+" 0":(r.id[0]=r.id[0]+this.baseTime,2===r.id.length?r.id=r.id[0]+" "+this.remoteNodeId+" "+r.id[1]:r.id=r.id.join(" ")),r.time=r.time+this.baseTime,t.timeFix&&(r.time=r.time+t.timeFix);var s=Promise.resolve([i,r]);t.options.inMap&&(s=s.then(function(e){return t.options.inMap(e[0],e[1])}).catch(function(e){t.error(e)})),s.then(function(e){return t.options.inFilter?t.options.inFilter(e[0],e[1]).then(function(t){return!!t&&e}).catch(function(e){t.error(e)}):e}).then(function(e){return!!e&&(t.received[e[1].id]=!0,t.log.add(e[0],e[1]))}),n.push(s)}Promise.all(n).then(function(){t.setLastReceived(e),t.sendSynced(e)})},syncedMessage:function(e){this.endTimeout(),this.setLastSent(e),this.syncing>0&&(this.syncing-=1),0===this.syncing&&this.setState("synchronized")}}},function(e,t){e.exports={sendDebug:function(e,t){this.send(["debug",e,t])},debugMessage:function(e,t){this.emitter.emit("debug",e,t)}}},function(e,t,n){var o=n(0);function i(e,t){this.connected=!1,this.emitter=new o,this.type=t,this.pair=e}function r(e){this.delay=e||1,this.left=new i(this,"left"),this.right=new i(this,"right")}i.prototype={other:function(){return"left"===this.type?this.pair.right:this.pair.left},on:function(e,t){return this.emitter.on(e,t)},connect:function(){if(this.connected)throw new Error("Connection already established");this.emitter.emit("connecting");var e=this;return new Promise(function(t){setTimeout(function(){e.other().connected=!0,e.connected=!0,e.other().emitter.emit("connect"),e.emitter.emit("connect"),t()},e.pair.delay)})},disconnect:function(e){if(this.connected){this.connected=!1,this.emitter.emit("disconnect",e);var t=this;return new Promise(function(e){setTimeout(function(){t.other().connected=!1,t.other().emitter.emit("disconnect"),e()},1)})}throw new Error("Connection already finished")},send:function(e){if(!this.connected)throw new Error("Connection should be started before sending a message");var t=this;setTimeout(function(){t.other().emitter.emit("message",e)},t.pair.delay)}},r.prototype={},e.exports=r},function(e,t,n){var o=n(1),i=n(17);function r(e,t){return e.options.prefix+":"+e.options.userId+":"+t}function s(e,t,n){e.isLocalStorage&&localStorage.setItem(r(e,t),JSON.stringify(n))}function c(e){var t=localStorage.getItem(r(e,"leader")),n=[];return"string"==typeof t&&(n=JSON.parse(t)),n}function d(e){s(e,"leader",[e.id,Date.now()])}function a(e){"disconnected"!==e.state&&l(e,"disconnected"),g(e)}function A(e){clearTimeout(e.watching),e.watching=setTimeout(function(){h(e)?A(e):a(e)},e.roleTimeout)}function u(e,t){if(e.role!==t){var n=e.node;if(e.role=t,clearTimeout(e.watching),"leader"===t?(localStorage.removeItem(r(e,"state")),e.leadership=setInterval(function(){e.unloading||d(e)},e.leaderPing),n.connection.connect()):(clearTimeout(e.elections),clearInterval(e.leadership),"disconnected"!==n.state&&e.node.connection.disconnect()),"follower"===t){var o="disconnected",i=localStorage.getItem(r(e,"state"));i&&null!==i&&(o=JSON.parse(i)),o!==e.state&&(e.state=o,e.emitter.emit("state"))}e.emitter.emit("role")}}function h(e){var t=c(e);return t[1]&&t[1]>=Date.now()-e.leaderTimeout}function g(e){d(e),u(e,"candidate"),e.elections=setTimeout(function(){c(e)[0]===e.id?u(e,"leader"):(u(e,"follower"),A(e))},e.electionDelay)}function l(e,t){e.state=t,e.emitter.emit("state"),s(e,"state",e.state)}function f(e){return e.created&&e.added}function m(e){i.call(this,e),this.role="candidate",this.roleTimeout=3e3+Math.floor(1e3*Math.random()),this.leaderTimeout=5e3,this.leaderPing=2e3,this.electionDelay=1e3,this.state=this.node.state;var t=this;this.node.on("state",function(){"leader"===t.role&&l(t,t.node.state)}),this.log.on("add",function(e,n){t.emitter.emit("add",e,n),n.tab!==t.id&&s(t,"add",[t.id,e,n])}),this.log.on("clean",function(e,n){t.emitter.emit("clean",e,n),n.tab!==t.id&&s(t,"clean",[t.id,e,n])}),this.onStorage=this.onStorage.bind(this),this.onUnload=this.onUnload.bind(this),"undefined"!=typeof window&&(window.addEventListener("storage",this.onStorage),window.addEventListener("unload",this.onUnload))}m.prototype={start:function(){if(this.cleanPrevActions(),!this.isLocalStorage)return this.role="leader",this.emitter.emit("role"),void this.node.connection.connect();h(this)?(u(this,"follower"),A(this)):g(this)},destroy:function(){i.prototype.destroy.call(this),clearTimeout(this.watching),clearTimeout(this.elections),clearInterval(this.leadership),"undefined"!=typeof window&&window.removeEventListener("storage",this.onStorage)},clean:function(){return this.isLocalStorage&&(localStorage.removeItem(r(this,"add")),localStorage.removeItem(r(this,"clean")),localStorage.removeItem(r(this,"state")),localStorage.removeItem(r(this,"leader"))),i.prototype.clean.call(this)},on:function(e,t){return this.emitter.on(e,t)},onStorage:function(e){var t;if(null!==e.newValue)if(e.key===r(this,"add"))(t=JSON.parse(e.newValue))[0]!==this.id&&(t[2].tab&&t[2].tab!==this.id||(f(this.log.store)&&this.log.store.add(t[1],t[2]),this.emitter.emit("add",t[1],t[2]),"leader"===this.role&&this.node.onAdd(t[1],t[2])));else if(e.key===r(this,"clean"))(t=JSON.parse(e.newValue))[0]!==this.id&&(t[2].tab&&t[2].tab!==this.id||(f(this.log.store)&&this.log.store.remove(t[2].id),this.emitter.emit("clean",t[1],t[2])));else if(e.key===r(this,"leader"))0===(t=JSON.parse(e.newValue)).length?a(this):t[0]!==this.id&&"candidate"!==this.role&&(u(this,"follower"),A(this));else if(e.key===r(this,"state")){var n=JSON.parse(localStorage.getItem(e.key));this.state!==n&&(this.state=n,this.emitter.emit("state"))}},onUnload:function(){"leader"===this.role&&(this.unloading=!0,s(this,"leader",[])),i.prototype.onUnload.call(this)}},m.prototype=o(m.prototype,i.prototype),Object.defineProperty(m.prototype,"connected",{get:function(){return"disconnected"!==this.state&&"connecting"!==this.state}}),e.exports=m},function(e,t,n){(function(t){var o=n(18),i=n(2),r=n(4),s=n(0),c=n(19),d=n(20),a=n(7),A=n(21);function u(e){localStorage.setItem(e.options.prefix+":tab:"+e.id,Date.now())}function h(e,t){e.log.removeReason("tab"+t).then(function(){e.isLocalStorage&&localStorage.removeItem(e.options.prefix+":tab:"+t)})}var g=["id","time","nodeIds","users","channels"];function l(e){if(this.options=e||{},void 0===this.options.prefix&&(this.options.prefix="logux"),this.options.time?this.id="test"+(this.options.time.lastId+1):this.id=d(8),this.options.userId=this.options.userId.toString(),this.isLocalStorage=!1,"undefined"!=typeof localStorage)try{localStorage.setItem(this.id,"1"),localStorage.removeItem(this.id),this.isLocalStorage=!0}catch(e){}var n;this.nodeId=this.options.userId+":"+this.id,/^ws:\/\//.test(this.options.server)&&!e.allowDangerousProtocol&&(n=function(e){return"object"!=typeof e||"development"!==e.env?(console.error("Without SSL, old proxies block WebSockets. Use WSS for Logux or set allowDangerousProtocol option."),Promise.resolve(!1)):Promise.resolve(!0)});var h,l=this.options.store;l||(l=t.indexedDB?new A(this.options.prefix+":"+this.options.userId):new i),h=this.options.time?this.options.time.nextLog({store:l,nodeId:this.nodeId}):new a({store:l,nodeId:this.nodeId}),this.log=h;var f=this;function m(e,t){var n,o=e.type;"logux/subscribe"===o?(n=JSON.stringify(e),f.subscriptions.some(function(t){return t.channel===e.channel&&JSON.stringify(t)===n})||f.subscriptions.push(e)):"logux/unsubscribe"===o&&(n=JSON.stringify(function(e){var t={};for(var n in e)"type"===n?t.type="logux/subscribe":t[n]=e[n];return t}(e)),f.subscriptions=f.subscriptions.filter(function(t){return t.channel!==e.channel||JSON.stringify(t)!==n}))}h.on("preadd",function(e,t){-1!==t.id.indexOf(" "+f.nodeId+" ")&&!t.subprotocol&&(t.subprotocol=f.options.subprotocol)}),this.subscriptions=[],this.emitter=new s,this.on?this.on("add",m):h.on("add",m),this.tabPing=6e4,this.tabTimeout=10*this.tabPing;var p,v="tab"+f.id;if(this.isLocalStorage)var y=h.on("add",function(e,t){-1!==t.reasons.indexOf(v)&&(u(f),f.pinging=setInterval(function(){u(f)},f.tabPing),y())});if("string"==typeof this.options.server){var I=new o(this.options.server);p=new c(I,{minDelay:this.options.minDelay,maxDelay:this.options.maxDelay,attempts:this.options.attempts})}else p=this.options.server;this.node=new r(this.nodeId,this.log,p,{credentials:this.options.credentials,subprotocol:this.options.subprotocol,outFilter:function(e,t){var n=t.id.split(" ")[1].replace(/:[^:]*$/,"");return Promise.resolve(!!t.sync&&n===f.options.userId)},timeout:this.options.timeout,outMap:function(e,t){var n={};for(var o in t)-1!==g.indexOf(o)&&(n[o]=t[o]),t.subprotocol&&t.subprotocol!==f.options.subprotocol&&(n.subprotocol=t.subprotocol);return Promise.resolve([e,n])},ping:this.options.ping,auth:n}),this.node.on("debug",function(e,t){"error"===e&&console.error("Error on Logux server:\n",t)});var D=!1;this.node.on("state",function(){if("synchronized"===f.node.state&&D)for(var e in D=!1,f.subscriptions)f.log.add(f.subscriptions[e],{sync:!0});else"disconnected"===f.node.state&&(D=!0)}),this.onUnload=this.onUnload.bind(this),"undefined"!=typeof window&&window.addEventListener("unload",this.onUnload)}l.prototype={start:function(){this.cleanPrevActions(),this.node.connection.connect()},destroy:function(){this.onUnload(),this.node.destroy(),clearInterval(this.pinging),"undefined"!=typeof window&&window.removeEventListener("unload",this.onUnload)},clean:function(){return this.destroy(),this.log.store.clean?this.log.store.clean():Promise.resolve()},cleanPrevActions:function(){if(this.isLocalStorage)for(var e in localStorage){var t=this.options.prefix+":tab:";if(e.slice(0,t.length)===t){var n=parseInt(localStorage.getItem(e));Date.now()-n>this.tabTimeout&&h(this,e.slice(t.length))}}},onUnload:function(){this.pinging&&h(this,this.id)}},e.exports=l}).call(this,n(8))},function(e,t,n){var o=n(0);function i(e,t,n){if(this.connected=!1,this.emitter=new o,t)this.WS=t;else{if("undefined"==typeof WebSocket)throw new Error("System has no WebSocket support");this.WS=WebSocket}this.url=e,this.opts=n}i.prototype={init:function(e){var t=this;e.onerror=function(e){t.emitter.emit("error",e.error||new Error("WS Error"))},e.onclose=function(){t.ws&&(t.connected=!1,t.emitter.emit("disconnect"))},e.onmessage=function(e){var n;try{n=JSON.parse(e.data)}catch(n){return void t.error(e.data)}t.emitter.emit("message",n)},this.ws=e},connect:function(){this.emitter.emit("connecting"),this.init(new this.WS(this.url,void 0,this.opts));var e=this;return new Promise(function(t){e.ws.onopen=function(){e.connected=!0,e.emitter.emit("connect"),t()}})},disconnect:function(){this.ws&&(this.ws.onclose(),this.ws.close(),this.ws=void 0)},on:function(e,t){return this.emitter.on(e,t)},send:function(e){this.ws&&this.ws.readyState===this.ws.OPEN?this.ws.send(JSON.stringify(e)):this.disconnect()},error:function(e){var t=new Error("Wrong message format");t.received=e,this.emitter.emit("error",t)}},e.exports=i},function(e,t,n){var o=n(1),i={minDelay:1e3,maxDelay:5e3,attempts:1/0},r=["wrong-protocol","wrong-subprotocol","wrong-credentials"];function s(e,t){this.connection=e,this.options=o(t,i),this.reconnecting=e.connected,this.connecting=!1,this.attempts=0,this.unbind=[];var n=this;function s(){!n.reconnecting||n.connected||n.connecting||document.hidden||n.connect()}function c(){!n.reconnecting||n.connected||n.connecting||navigator.onLine&&n.connect()}function d(){n.disconnect("freeze")}this.unbind.push(this.connection.on("message",function(e){"error"===e[0]&&-1!==r.indexOf(e[1])&&(n.reconnecting=!1)})),this.unbind.push(this.connection.on("connecting",function(){n.connecting=!0})),this.unbind.push(this.connection.on("connect",function(){n.attempts=0,n.connecting=!1})),this.unbind.push(this.connection.on("disconnect",function(){n.connecting=!1,n.reconnecting&&n.reconnect()})),this.unbind.push(function(){clearTimeout(n.timer)}),"undefined"!=typeof navigator&&(document.addEventListener("visibilitychange",s,!1),window.addEventListener("focus",c,!1),window.addEventListener("online",c,!1),window.addEventListener("resume",c,!1),window.addEventListener("freeze",d,!1),this.unbind.push(function(){document.removeEventListener("visibilitychange",s,!1),window.removeEventListener("focus",c,!1),window.removeEventListener("online",c,!1),window.removeEventListener("resume",c,!1),window.removeEventListener("freeze",d,!1)}))}s.prototype={connect:function(){return this.attempts+=1,this.reconnecting=!0,this.connection.connect()},disconnect:function(e){return"timeout"!==e&&"error"!==e&&"freeze"!==e&&(this.reconnecting=!1),this.connection.disconnect(e)},destroy:function(){for(var e=0;e<this.unbind.length;e++)this.unbind[e]();this.disconnect("destroy")},reconnect:function(){if(this.attempts>this.options.attempts-1)return this.reconnecting=!1,void(this.attempts=0);var e=this.nextDelay(),t=this;this.timer=setTimeout(function(){!t.reconnecting||t.connecting||t.connected||t.connect()},e)},send:function(){return this.connection.send.apply(this.connection,arguments)},on:function(){return this.connection.on.apply(this.connection,arguments)},nextDelay:function(){var e=this.options.minDelay*Math.pow(2,this.attempts),t=Math.random(),n=Math.floor(.5*t*e);return 1===Math.floor(10*t)&&(n=-n),Math.min(e+n,this.options.maxDelay)||0}},Object.defineProperty(s.prototype,"connected",{get:function(){return this.connection.connected}}),e.exports=s},function(e,t,n){var o=self.crypto||self.msCrypto;e.exports=function(e){e=e||21;for(var t="",n=o.getRandomValues(new Uint8Array(e));0<e--;)t+="Uint8ArdomValuesObj012345679BCDEFGHIJKLMNPQRSTWXYZ_cfghkpqvwxyz~"[63&n[e]];return t}},function(e,t,n){(function(t){var o=n(3);function i(e,t){e.onerror=function(e){t(e.target.error)}}function r(e){return new Promise(function(t,n){i(e,n),e.onsuccess=function(e){t(e.target.result)}})}function s(e){return void 0!==e}function c(e){this.name=e||"logux",this.adding={}}c.prototype={init:function(){if(this.initing)return this.initing;var e=this,n=indexedDB.open(this.name,1);return n.onupgradeneeded=function(e){var t=e.target.result,n=t.createObjectStore("log",{keyPath:"added",autoIncrement:!0});n.createIndex("id","id",{unique:!0}),n.createIndex("created","created",{unique:!0}),n.createIndex("reasons","reasons",{multiEntry:!0}),t.createObjectStore("extra",{keyPath:"key"})},this.initing=r(n).then(function(n){return e.db=n,n.onversionchange=function(){e.db.close(),t.document&&t.document.reload&&t.document.reload()},e}),this.initing},get:function(e){var t;return this.init().then(function(n){var o=n.os("log");return r(t="created"===e.order?o.index("created").openCursor(null,"prev"):o.openCursor(null,"prev")).then(function e(t){return function(n){return n?(n.value.meta.added=n.value.added,{entries:[[n.value.action,n.value.meta]],next:function(){return n.continue(),r(t).then(e(t))}}):{entries:[]}}}(t))})},byId:function(e){return this.init().then(function(t){return r(t.os("log").index("id").get(e))}).then(function(e){return e?[e.action,e.meta]:[null,null]})},remove:function(e){return this.init().then(function(t){var n=t.os("log","write");return r(n.index("id").get(e)).then(function(e){return!!e&&r(n.delete(e.added)).then(function(){return e.meta.added=e.added,[e.action,e.meta]})})})},add:function(e,t){var n=t.id.split(" "),o={id:t.id,meta:t,time:t.time,action:e,reasons:t.reasons,created:[t.time,n[1],n[2],n[0]].join(" ")};return this.adding[o.created]?new Promise(function(e){e(!1)}):(this.adding[o.created]=!0,this.init().then(function(e){var n=e.os("log","write");return r(n.index("id").get(t.id)).then(function(i){return!i&&r(n.add(o)).then(function(n){return delete e.adding[o.created],t.added=n,t})})}))},changeMeta:function(e,t){return this.init().then(function(n){var o=n.os("log","write");return r(o.index("id").get(e)).then(function(e){if(e){for(var n in t)e.meta[n]=t[n];return t.reasons&&(e.reasons=t.reasons),r(o.put(e)).then(function(){return!0})}return!1})})},removeReason:function(e,t,n){return this.init().then(function(c){var d=c.os("log","write");if(t.id)return r(d.index("id").get(t.id)).then(function(t){if(!t)return Promise.resolve();var o=t.meta.reasons.indexOf(e);return-1!==o?(t.meta.reasons.splice(o,1),t.reasons=t.meta.reasons,0===t.meta.reasons.length?(n(t.action,t.meta),r(d.delete(t.added))):r(d.put(t))):Promise.resolve()});var a=d.index("reasons").openCursor(e);return new Promise(function(r,c){i(a,c),a.onsuccess=function(a){if(a.target.result){var A,u=a.target.result.value,h=u.meta,g=t;if(!s(g.olderThan)||o(h,g.olderThan))if(!s(g.youngerThan)||o(g.youngerThan,h))if(s(g.minAdded)&&u.added<g.minAdded)a.target.result.continue();else if(s(g.maxAdded)&&u.added>g.maxAdded)a.target.result.continue();else 1===u.reasons.length?(u.meta.reasons=[],u.meta.added=u.added,n(u.action,u.meta),A=d.delete(u.added)):(u.reasons.splice(u.reasons.indexOf(e),1),u.meta.reasons=u.reasons,A=d.put(u)),i(A,c),A.onsuccess=function(){a.target.result.continue()};else a.target.result.continue();else a.target.result.continue()}else r()}})})},getLastAdded:function(){return this.init().then(function(e){return r(e.os("log").openCursor(null,"prev"))}).then(function(e){return e?e.value.added:0})},getLastSynced:function(){return this.init().then(function(e){return r(e.os("extra").get("lastSynced"))}).then(function(e){return e?{sent:e.sent,received:e.received}:{sent:0,received:0}})},setLastSynced:function(e){return this.init().then(function(t){var n=t.os("extra","write");return r(n.get("lastSynced")).then(function(t){return t||(t={key:"lastSynced",sent:0,received:0}),void 0!==e.sent&&(t.sent=e.sent),void 0!==e.received&&(t.received=e.received),r(n.put(t))})})},os:function(e,t){var n=t?"readwrite":"readonly";return this.db.transaction(e,n).objectStore(e)},clean:function(){return this.init().then(function(e){return e.db.close(),r(t.indexedDB.deleteDatabase(e.name))})}},e.exports=c}).call(this,n(8))},function(e,t){e.exports=function(e){var t=document,n=!1,o=[],i=!1;function r(){n&&(t.title=n,n=!1)}function s(){t.hidden&&!n?(n=t.title,t.title="* "+t.title):r(),t.hidden&&(i=setTimeout(s,1e3))}function c(){!t.hidden&&i&&(i=clearTimeout(i),r())}return t&&void 0!==t.hidden&&(o.push(e.node.on("error",function(e){"timeout"===e.type||i||s()})),o.push(e.log.on("add",function(e){"logux/undo"===e.type&&e.reason&&!i&&s()})),document.addEventListener("visibilitychange",c,!1),o.push(function(){document.removeEventListener("visibilitychange",c,!1)})),function(){for(var e=0;e<o.length;e++)o[e]()}}},function(e,t){function n(e){return void 0===e&&(e=window.event),e&&(e.returnValue="unsynced"),"unsynced"}e.exports=function(e){var t="disconnected"===e.state,o=!1;function i(){"disconnected"===e.state?t=!0:"synchronized"===e.state&&(t=!1,o=!1),"follower"!==e.role&&o&&t?window.addEventListener("beforeunload",n):window.removeEventListener("beforeunload",n)}var r=[];return r.push(e.on("role",i)),r.push(e.on("state",i)),i(),r.push(e.log.on("add",function(e,n){"logux/subscribe"!==e.type&&"logux/unsubscribe"!==e.type&&t&&n.sync&&n.added&&(o=!0,i())})),function(){for(var e=0;e<r.length;e++)r[e]()}}},function(e,t){e.exports=function(e,t){var n=t.normal,o=t.offline,i=t.error,r=[],s=document,c=!1,d=!1;function a(){e.connected&&d!==n?c.href=d=n:!e.connected&&o&&d!==o&&d!==i&&(c.href=d=o)}function A(){i&&d!==i&&(c.href=d=i)}return s&&(c=s.querySelector('link[rel~="icon"]'),void 0===n&&(n=c?c.href:""),c||((c=s.createElement("link")).rel="icon",c.href="",s.head.appendChild(c)),r.push(e.on("state",a)),a(),r.push(e.log.on("add",function(e){"logux/undo"===e.type&&e.reason&&A()})),r.push(e.node.on("error",function(e){"timeout"!==e.type&&A()}))),function(){for(var e=0;e<r.length;e++)r[e]()}}},function(e,t,n){var o=n(26);function i(e,t){for(var n in t)e.style[n]=t[n]}var r={boxSizing:"content-box",visibility:"visible",textIndent:"0",textTransform:"none",wordSpacing:"normal",letterSpacing:"normal",fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",lineHeight:"auto"};e.exports=function(e,t){var n=t.messages,s=t.position||"bottom-right",c=t.styles,d=document.createElement("div"),a=document.createElement("span");function A(e,t){a.innerHTML=t,i(d,e),d.style.display="block"}d.setAttribute("role","alert"),i(d,r),i(d,c.base),i(a,c.text),function(e,t){var n=e.style;"middle-center"===t||"center-middle"===t?(n.top="50%",n.left="50%",n.transform="translate(-50%, -50%)"):t.split("-").forEach(function(e){"middle"===e?(n.top="50%",n.transform="translateY(-50%)"):"center"===e?(n.left="50%",n.transform="translateX(-50%)"):n[e]="0"})}(d,s);var u=o(e,function(e){"sendingAfterWait"===e||"connectingAfterWait"===e?A(c.sending,n.sending):"synchronizedAfterWait"===e?A(c.synchronized,n.synchronized):"synchronized"===e?d.style.display="none":"disconnected"===e?A(c.disconnected,n.disconnected):"wait"===e?A(c.wait,n.wait):"protocolError"===e?A(c.protocolError,n.protocolError):"syncError"===e?A(c.error,n.syncError):"error"===e?A(c.error,n.error):"denied"===e&&A(c.error,n.denied)},t);return d.appendChild(a),document.body.appendChild(d),function(){u(),document.body.removeChild(d)}}},function(e,t){e.exports=function(e,t,n){var o,i=e.on?e:e.node,r="disconnected"===i.state,s=!1,c=!1;n||(n={}),void 0===n.duration&&(n.duration=3e3);var d=[],a={};function A(){0===Object.keys(a).length&&(s?(s=!1,t("synchronizedAfterWait"),o=setTimeout(function(){t("synchronized")},n.duration)):t("synchronized"))}d.push(i.on("state",function(){clearTimeout(o),c||("disconnected"===i.state?(r=!0,t(s?"wait":"disconnected")):"synchronized"===i.state?(r=!1,A()):"connecting"===i.state?o=setTimeout(function(){t("connecting"+(s?"AfterWait":""))},100):t(e.state+(s?"AfterWait":"")))})),d.push(e.node.on("error",function(e){"wrong-protocol"===e.type||"wrong-subprotocol"===e.type?(c=!0,t("protocolError")):"timeout"!==e.type&&t("syncError",{error:e})})),d.push(e.node.on("clientError",function(e){t("syncError",{error:e})}));var u=e.on?e:e.log;return d.push(u.on("add",function(e,n){"logux/subscribe"!==e.type&&"logux/unsubscribe"!==e.type&&("logux/processed"===e.type?(delete a[e.id],A()):"logux/undo"===e.type?delete a[e.id]:n.sync&&(a[n.id]=!0),"logux/undo"===e.type&&e.reason?"denied"===e.reason?t("denied",{action:e,meta:n}):t("error",{action:e,meta:n}):r&&n.sync&&n.added&&(s||t("wait"),s=!0))})),function(){for(var e=0;e<d.length;e++)d[e]()}}},function(e,t,n){var o=n(28);function i(e){return"%c"+e+"%c"}function r(e,t,n,o){t="%cLogux:%c "+t,e||(t=t.replace(/%c/g,""));var i=[t];if(e)for(var r=t.match(/%c[^%]+%c/g),s=0;s<r.length;s++)0===s?i.push("color: #ffa200"):i.push("font-weight: bold"),i.push("");return n&&o&&(i.push(n),i.push(o)),i}e.exports=function(e,t){t||(t={});var n=e.node,s=!1!==t.color&&o();function c(e,t,n){console.log.apply(console,r(s,e,t,n))}function d(e){var t="error: "+e.description;e.received&&(t="server sent "+t),console.error.apply(console,r(s,t))}var a=[],A=!1;!1!==t.state&&a.push(e.on("state",function(){var t="";"connecting"===e.state&&n.connection.url?t=". "+i(n.localNodeId)+" is connecting to "+i(n.connection.url)+".":e.connected&&!A&&n.remoteNodeId?(t=". Client was connected to "+i(n.remoteNodeId)+".",A=!0):e.connected||(A=!1),c("state was changed to "+i(e.state)+t)})),!1!==t.role&&a.push(e.on("role",function(){c("tab role was changed to "+i(e.role))})),!1!==t.error&&(a.push(n.on("error",function(e){d(e)})),a.push(n.on("clientError",function(e){d(e)})));var u={},h=(t.ignoreActions||[]).reduce(function(e,t){return e[t]=!0,e},{});return!1!==t.add&&a.push(e.on("add",function(t,o){if(!(o.tab&&o.tab!==e.id||h[t.type])){var r="action "+i(t.type)+" was added";0===o.reasons.length&&(u[o.id]=!0,r+=" and cleaned");var s=o.id.split(" ")[1];s!==n.localNodeId&&(r+=" by "+i(s)),c(r,t,o)}})),!1!==t.clean&&a.push(e.on("clean",function(t,n){u[n.id]?delete u[n.id]:n.tab&&n.tab!==e.id||h[t.type]||c("action "+i(t.type)+" was cleaned",t,n)})),function(){for(var e=0;e<a.length;e++)a[e]()}}},function(e,t){e.exports=function(){if("undefined"==typeof window||"undefined"==typeof document)return!1;var e=navigator.userAgent.toLowerCase().indexOf("edge")>-1,t="WebkitAppearance"in document.documentElement.style,n=window.console&&(window.console.firebug||window.console.exception&&window.console.table)&&!0,o=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31;return t&&!e||n||o||!1}},function(e,t){e.exports={synchronized:"Your data has been saved",disconnected:"No Internet connection",wait:"No Internet connection<br>Your data has not been saved",sending:"Data saving",syncError:"Server error<br>Your data has not been saved",error:"Server error<br>You changes was reverted",denied:"You have no access<br>You changes was reverted",protocolError:"Saving is not working<br>Refresh the page"}},function(e,t,n){var o=n(31),i=n(32),r=n(33),s=n(34);e.exports={base:{position:"fixed",width:"15.4em",height:"4em",lineHeight:"1.4",margin:"1.5em",paddingLeft:"4.2em",opacity:"0.8",borderRadius:"0.4em",color:"#fff",fontFamily:"Helvetica Neue, sans-serif",zIndex:"999",backgroundPosition:"1.2em center",backgroundRepeat:"no-repeat",backgroundSize:"1.8em"},text:{display:"table-cell",verticalAlign:"middle",height:"4em"},synchronized:{backgroundColor:"#000",backgroundImage:"url("+i+")"},disconnected:{backgroundColor:"#000",backgroundImage:"url("+r+")"},wait:{backgroundColor:"#000",backgroundImage:"url("+r+")"},sending:{backgroundColor:"#000",backgroundImage:"url("+o+")"},error:{backgroundColor:"#F42A2A",backgroundImage:"url("+s+")"},protocolError:{backgroundColor:"#000",backgroundImage:"url("+o+")"}}},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIxNSAxNCAyMCAyMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTcuOTMyIDMyLjA2OGwxLjQxNC0xLjQxNEE3Ljk3NSA3Ljk3NSAwIDAgMCAyNSAzM2M0LjQxMSAwIDgtMy41ODkgOC04aDJjMCA1LjUxNC00LjQ4NiAxMC0xMCAxMGE5Ljk2OSA5Ljk2OSAwIDAgMS03LjA2OC0yLjkzMnpNMTUgMjVjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGE5Ljk2OSA5Ljk2OSAwIDAgMSA3LjA2OCAyLjkzMmwtMS40MTQgMS40MTRBNy45NzUgNy45NzUgMCAwIDAgMjUgMTdjLTQuNDExIDAtOCAzLjU4OS04IDhoLTJ6bTE4LjUtOC41TDI5IDIxbDYgMi0xLjUtNi41ek0yMSAyOWwtNC41IDQuNUwxNSAyN2w2IDJ6IiBmaWxsPSIjRkZGIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIxMyAxNyAyMyAxNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InNxdWFyZSIgZmlsbD0ibm9uZSIgZD0iTTE0LjUgMjUuNWw2LjY3IDYuNjdMMzQuNSAxOC41Ii8+PC9zdmc+"},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIxNSAxNCAyMCAyMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTcuOTMyIDMyLjA2OGwxLjQxNC0xLjQxNEE3Ljk3NSA3Ljk3NSAwIDAgMCAyNSAzM2M0LjQxMSAwIDgtMy41ODkgOC04aDJjMCA1LjUxNC00LjQ4NiAxMC0xMCAxMGE5Ljk2OSA5Ljk2OSAwIDAgMS03LjA2OC0yLjkzMnpNMTUgMjVjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGE5Ljk2OSA5Ljk2OSAwIDAgMSA3LjA2OCAyLjkzMmwtMS40MTQgMS40MTRBNy45NzUgNy45NzUgMCAwIDAgMjUgMTdjLTQuNDExIDAtOCAzLjU4OS04IDhoLTJ6bTE4LjUtOC41TDI5IDIxbDYgMi0xLjUtNi41ek0yMSAyOWwtNC41IDQuNUwxNSAyN2w2IDJ6bTMtMTBoMnY0bC0uNSA0aC0xbC0uNS00di00em0xIDExYTEgMSAwIDEgMSAwLTIgMSAxIDAgMCAxIDAgMnoiIGZpbGw9IiNGRkYiIGZpbGwtcnVsZT0iZXZlbm9kZCIvPjwvc3ZnPg=="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIxMyAxNCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMjAgMjloLTFhNCA0IDAgMCAxLS45OTgtNy44NzQgNSA1IDAgMCAxIDkuMzMzLTIuNjIxIDMgMyAwIDAgMSA0LjQ5IDMuNTFBMy41IDMuNSAwIDAgMSAzMS40OTkgMjlIMzB2MmgxLjVhNS41IDUuNSAwIDAgMCAyLjQ4NC0xMC40MDggNSA1IDAgMCAwLTUuOTg1LTQuNDkyIDcuMDAzIDcuMDAzIDAgMCAwLTExLjg4NiAzLjY0QTYgNiAwIDAgMCAxOSAzMWgxdi0yem02LTYuNTAybC01IDguNDUxIDQgLjAyNS0yIDYuNTQ2IDYtOC40ODMtNC0uMDExIDEtNi41Mjh6IiBmaWxsPSIjRkZGIi8+PC9zdmc+"},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAMAAAAOusbgAAABzlBMVEUAAAAAAACAgICZmZmAgICSkpKLi4uAgICJiYmAgICIiIiHh4eAgICGhoaAgICGhoaAgICFhYWAgICFhYWAgICEhISAgICEhISAgICEhISAgICDg4OAgICDg4OAgICDg4OAgICDg4OAgICDg4OAgICCgoKAgICAgICCgoKAgICCgoKAgICAgICCgoKAgICCgoKAgICCgoKAgICBgYGBgYGAgICBgYGAgICBgYGBgYGAgICAgICBgYGAgICBgYGAgICBgYGAgICAgICBgYGAgICBgYGBgYGAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICq+RHaAAAAmXRSTlMAAQQFBgcLDA0ODxESExQVFhcYGRobHB0eHyAhIiMkJSYnKCksLS4wMTI3ODo7PD0+P0xNT1BTVFVXWFpbXl9gYWJmaWprbW6AgYKDhYaHiImKi4yNjo+RkpSXmZqbnJ2foqqtrq+5u7y+xMXGx8jJysvQ0dLT1dbY2drc3d7g4eLj5OXm5+jq6+zt7u/w8fX29/j5+vv8/f5OSOWKAAACyklEQVR4Ae3aA7okSxQE4Bjbtm3bc23btm2b1f1ex25nA1nO813Vv4BCGoGdIBAIBI49/ZVS1dQ5uGAYC4OdTZUpv54eg7TTHwuGqDBZ/vsSxNxJ7qeFvsTbEHA8po22WqKPQ6+LOSt0ZL3gAvS5krNGx0Jlt6DH/pQwXQnnHIIGb8bo2uS3XfDpSh09qb0EX94u0KOlj/BuT0qEnkVy9sKjM230pfkUPLnST5+GbsCDexP0bfohXHu1TA2WX8Cl+4vUYvkRXLk2RU1mbsKFk/3UZvA0HNvXRo2a98KpXGqVCYdeR6hV5B0cuThPzRauwIFdddSuBg58pYBPsHVoggKmDsu3aLUs2LjxH0WEr8FaCYUUwtIFg0JCl2Alj2JyYOHEKsWsHoO5GAqKgrk2CmqGqTsUdQtmkikqHmb6KaoHJs5R2DmofaOwr1ArpbBiqI1Q2BCUjlPcUag8o7gnUPlFcd+hkkpxSVCporgKqDRRXD1UuiiuAyrDFDcElXmKm4WKQXHrG//ijS/qjWxcG9adNmwA2bAhM4XiEqHyk+K+QeUpxT2GylGKO4qN6chDG7W8LdqoBf0XqJ2lrMgZmOilqG6YSaKoOJi5uVEbc7RSUCPMRVPQH5g7vkoxK8dgIZdismHlvEEh6+dgqYhC8mHtWpgiQldgI5si0mHn4DgFTB6Crc8U8AEO1FK7ajhxYY6aLVzeoCu+t1CRb9lpcGpvMzVq2APHTvRSm4FTcOHqJDWZvAJX7ukKJzyESy+XqMHSc7h2d5y+TT2AB1f66NPgdXhyqpm+NJyAR7tj/5ePVam9madHS+/hy6UaelJ9AX69GaVrE9+gwaGsMF0JZRyAHpfdBEKNshvQ51SK4wjseeh1LKqZtpr+HoWAmwk9tNAddwNiTn4sGDQJdl+AtKNPfiRXNLQPzhvG/GB7fUXS9ydHsAMEAoHAP3w+T5jYJRnoAAAAAElFTkSuQmCC"},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAMAAAAOusbgAAABzlBMVEUAAAAAAAAAgAAAmQAAgAAAkgAAiwAAgAAAiQAAgAAAiAAAhwAAgAAAhgAAgAAAhgAAgAAAhQAAgAAAhQAAgAAAhAAAgAAAhAAAgAAAhAAAgAAAgwAAgAAAgwAAgAAAgwAAgAAAgwAAgAAAgwAAgAAAggAAgAAAgAAAggAAgAAAggAAgAAAgAAAggAAgAAAggAAgAAAggAAgAAAgQAAgQAAgAAAgQAAgAAAgQAAgQAAgAAAgAAAgQAAgAAAgQAAgAAAgQAAgAAAgAAAgQAAgAAAgQAAgQAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgAAAgACYS+jrAAAAmXRSTlMAAQQFBgcLDA0ODxESExQVFhcYGRobHB0eHyAhIiMkJSYnKCksLS4wMTI3ODo7PD0+P0xNT1BTVFVXWFpbXl9gYWJmaWprbW6AgYKDhYaHiImKi4yNjo+RkpSXmZqbnJ2foqqtrq+5u7y+xMXGx8jJysvQ0dLT1dbY2drc3d7g4eLj5OXm5+jq6+zt7u/w8fX29/j5+vv8/f5OSOWKAAACyklEQVR4Ae3aA7okSxQE4Bjbtm3bc23btm2b1f1ex25nA1nO813Vv4BCGoGdIBAIBI49/ZVS1dQ5uGAYC4OdTZUpv54eg7TTHwuGqDBZ/vsSxNxJ7qeFvsTbEHA8po22WqKPQ6+LOSt0ZL3gAvS5krNGx0Jlt6DH/pQwXQnnHIIGb8bo2uS3XfDpSh09qb0EX94u0KOlj/BuT0qEnkVy9sKjM230pfkUPLnST5+GbsCDexP0bfohXHu1TA2WX8Cl+4vUYvkRXLk2RU1mbsKFk/3UZvA0HNvXRo2a98KpXGqVCYdeR6hV5B0cuThPzRauwIFdddSuBg58pYBPsHVoggKmDsu3aLUs2LjxH0WEr8FaCYUUwtIFg0JCl2Alj2JyYOHEKsWsHoO5GAqKgrk2CmqGqTsUdQtmkikqHmb6KaoHJs5R2DmofaOwr1ArpbBiqI1Q2BCUjlPcUag8o7gnUPlFcd+hkkpxSVCporgKqDRRXD1UuiiuAyrDFDcElXmKm4WKQXHrG//ijS/qjWxcG9adNmwA2bAhM4XiEqHyk+K+QeUpxT2GylGKO4qN6chDG7W8LdqoBf0XqJ2lrMgZmOilqG6YSaKoOJi5uVEbc7RSUCPMRVPQH5g7vkoxK8dgIZdismHlvEEh6+dgqYhC8mHtWpgiQldgI5si0mHn4DgFTB6Crc8U8AEO1FK7ajhxYY6aLVzeoCu+t1CRb9lpcGpvMzVq2APHTvRSm4FTcOHqJDWZvAJX7ukKJzyESy+XqMHSc7h2d5y+TT2AB1f66NPgdXhyqpm+NJyAR7tj/5ePVam9madHS+/hy6UaelJ9AX69GaVrE9+gwaGsMF0JZRyAHpfdBEKNshvQ51SK4wjseeh1LKqZtpr+HoWAmwk9tNAddwNiTn4sGDQJdl+AtKNPfiRXNLQPzhvG/GB7fUXS9ydHsAMEAoHAP3w+T5jYJRnoAAAAAElFTkSuQmCC"},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAMAAAAOusbgAAABzlBMVEUAAAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AADGIKqbAAAAmXRSTlMAAQQFBgcLDA0ODxESExQVFhcYGRobHB0eHyAhIiMkJSYnKCksLS4wMTI3ODo7PD0+P0xNT1BTVFVXWFpbXl9gYWJmaWprbW6AgYKDhYaHiImKi4yNjo+RkpSXmZqbnJ2foqqtrq+5u7y+xMXGx8jJysvQ0dLT1dbY2drc3d7g4eLj5OXm5+jq6+zt7u/w8fX29/j5+vv8/f5OSOWKAAACyklEQVR4Ae3aA7okSxQE4Bjbtm3bc23btm2b1f1ex25nA1nO813Vv4BCGoGdIBAIBI49/ZVS1dQ5uGAYC4OdTZUpv54eg7TTHwuGqDBZ/vsSxNxJ7qeFvsTbEHA8po22WqKPQ6+LOSt0ZL3gAvS5krNGx0Jlt6DH/pQwXQnnHIIGb8bo2uS3XfDpSh09qb0EX94u0KOlj/BuT0qEnkVy9sKjM230pfkUPLnST5+GbsCDexP0bfohXHu1TA2WX8Cl+4vUYvkRXLk2RU1mbsKFk/3UZvA0HNvXRo2a98KpXGqVCYdeR6hV5B0cuThPzRauwIFdddSuBg58pYBPsHVoggKmDsu3aLUs2LjxH0WEr8FaCYUUwtIFg0JCl2Alj2JyYOHEKsWsHoO5GAqKgrk2CmqGqTsUdQtmkikqHmb6KaoHJs5R2DmofaOwr1ArpbBiqI1Q2BCUjlPcUag8o7gnUPlFcd+hkkpxSVCporgKqDRRXD1UuiiuAyrDFDcElXmKm4WKQXHrG//ijS/qjWxcG9adNmwA2bAhM4XiEqHyk+K+QeUpxT2GylGKO4qN6chDG7W8LdqoBf0XqJ2lrMgZmOilqG6YSaKoOJi5uVEbc7RSUCPMRVPQH5g7vkoxK8dgIZdismHlvEEh6+dgqYhC8mHtWpgiQldgI5si0mHn4DgFTB6Crc8U8AEO1FK7ajhxYY6aLVzeoCu+t1CRb9lpcGpvMzVq2APHTvRSm4FTcOHqJDWZvAJX7ukKJzyESy+XqMHSc7h2d5y+TT2AB1f66NPgdXhyqpm+NJyAR7tj/5ePVam9madHS+/hy6UaelJ9AX69GaVrE9+gwaGsMF0JZRyAHpfdBEKNshvQ51SK4wjseeh1LKqZtpr+HoWAmwk9tNAddwNiTn4sGDQJdl+AtKNPfiRXNLQPzhvG/GB7fUXS9ydHsAMEAoHAP3w+T5jYJRnoAAAAAElFTkSuQmCC"}]);